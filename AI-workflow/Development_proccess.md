# Development Process (Cursor + Codex + GitHub)

> Примечание: этот документ описывает **как мы пишем и вливаем код**. Управление Kanban/Issue-описания — в `Management-Process.md`.

---

## Цели процесса разработки
- Делать изменения маленькими, проверяемыми и легко ревьюимыми.
- Поддерживать автономность агентов: понятный DoD, тест-план, связка Issue ↔ PR ↔ Context Pack.
- Уменьшать регрессии: минимум проверок в CI и обязательное ревью.

---

## Базовые правила

### 1) Один Issue → один PR (по возможности)
- Каждая задача (Task issue) должна приводить к одному PR.
- Если задача разрослась — её нужно **декомпозировать** на 2–3 issues, а не тащить огромный PR.

### 2) PR всегда связан с Issue
В PR description обязательно:
- `Closes #<issue>` (если PR полностью закрывает задачу)
- или `Refs #<issue>` (если PR часть работы)

Это нужно для:
- автоматического движения статусов
- прозрачного трекинга

### 3) Context Pack обновляется до и после PR
Минимум:
- до начала: скелет (Goal/DoD/тест-план)
- перед ревью: фактическая реализация/файлы/как проверить

### 4) Reviewer — обязательная стадия
Никаких “просто смёрджил в main”.
- Любой PR проходит ревью (человеком или Reviewer-агентом).

---

## Структура веток

### Ветка по задаче
Формат имени ветки:
- `issue-<id>-<slug>`

Примеры:
- `issue-123-auth-endpoint`
- `issue-58-portfolio-table`

### Commit-стиль (минимально)
Желательно (не обязательно):
- `feat: ...`
- `fix: ...`
- `chore: ...`
- `docs: ...`

Главное: коммиты должны помогать ревью, а не мешать.

---

## Шаблон PR (обязательные секции)

**Title:** кратко и по делу (обычно совпадает с Issue).

**Description:**
- Link: `Closes #<issue>`
- Summary: 3–8 буллетов “что сделано”
- How to test: шаги (или `make test`, `npm test`, и т.п.)
- Risks/Notes: что может сломаться или что не покрыто
- Screenshots/Logs: если UI/интеграции

**Checklist:**
- [ ] DoD выполнен
- [ ] Тест-план выполнен
- [ ] Context Pack обновлён
- [ ] Нет лишних файлов/секретов/мусора

---

## Тестирование

### Минимальный набор (желательно всегда)
- линтер/форматтер (если есть)
- unit tests (если применимо)
- быстрый smoke test (ручной или автоматический)

### Тест-план обязан быть в двух местах
- в Issue (кратко)
- в Context Pack (подробно, с командами/шагами)

### Если тестов нет
В PR обязательно объяснить:
- почему
- как проверить вручную
- что будет добавлено позже (если будет)

---

## Definition of Done (DoD)
DoD должен быть:
- конкретным
- проверяемым
- измеряемым

Примеры хорошего DoD:
- “Добавлен endpoint `/api/login` + валидация + 401 на неверные креды + unit tests на 3 кейса”
- “UI-таблица рендерит 1000 строк без лагов, есть пустое состояние, сортировка по 2 колонкам, e2e smoke”

---

## Обновление статусов (важная связка с Kanban)

Цель: статусы отражают реальность без ручной рутины.

### Правило статусов
- Начал делать → **In Progress**
- Открыл PR → **In Review**
- Смёрджено → **Done**

### Автоматизация
План: GitHub Actions двигают карточку GitHub Projects:
- PR opened/ready_for_review → In Review
- PR merged → Done

Если автоматика ещё не включена — это всё равно обязательное правило, просто делается вручную.

---

## Процесс ревью (Reviewer-агент / человек)

### Что проверяем в первую очередь
1) Соответствие Goal/DoD
2) Корректность тест-плана и наличие тестов
3) Простота поддержки: читаемость, naming, структура
4) Edge-cases и ошибки
5) Побочные эффекты / регрессии

### Как писать замечания
- конкретно: что не так
- почему важно
- что нужно изменить
- если возможно — пример

### Итог ревью
- **Approve**: можно мерджить
- **Request changes**: вернуть задачу в In Progress

---

## Работа с Codex (как исполнителем задач)

### Рекомендуемый подход
- Codex запускается **на конкретный Issue**
- Codex обязан:
  - прочитать Issue + Context Pack
  - выполнить DoD
  - обновить Context Pack
  - открыть PR с правильной связкой `Closes #<issue>`

### Деление на параллельные задачи
- Каждый Worker-агент / сессия Codex берёт **одну** задачу.
- Параллельные задачи должны быть независимыми (или чётко обозначить dependencies).

---

## Работа из Cursor

Cursor используется как:
- “командный пункт” (Planner и Reviewer-роль)
- место, где удобно править контекст (docs/Context Packs)
- место, где удобно запускать и координировать несколько задач

Рекомендуется:
- держать рядом открытым Issue + Context Pack
- фиксировать решения в markdown, а не в чате

---

## Частые проблемы и как их избегать

### PR слишком большой
- остановиться
- вытащить часть в отдельный Issue
- сделать 2 PR

### Агент “потерял контекст”
- вернуть его к Context Pack
- обновить Context Pack (архитектура/DoD)
- продолжить

### Ревью не может проверить
- добавь шаги запуска
- добавь тесты или чёткий manual тест-план
- сократи PR
