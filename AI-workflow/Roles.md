

# Roles & Responsibilities (Planner / Worker / Reviewer)

Этот документ описывает роли в агентной системе разработки, их обязанности, входы/выходы, а также что должно быть в проекте, чтобы роли работали автономно.

Связанные документы:
- `AI-workflow/Overview.md`
- `AI-workflow/Management-Process.md`
- `AI-workflow/Development_proccess.md`

---

## Общая схема

### Роли
- **Planner** — декомпозиция Epic → задачи, подготовка контекста.
- **Worker (N)** — реализация конкретной задачи → PR.
- **Reviewer** — ревью PR по правилам проекта → approve/request changes.

### Контракты между ролями
- **Issue** — контракт “что сделать” (Goal/DoD/Test plan/Dependencies).
- **Context Pack** — контракт “как и почему” (решение/файлы/тесты/риски).
- **PR** — контракт “что изменено” (summary/how to test/риски/чеклист).

---

## Обязательные артефакты в репозитории

### 1) `AGENTS.md` (в корне)
Единый набор правил, который обязаны читать все агенты.
Должно включать:
- Definition of Done (общий)
- стиль кода / форматирование
- требования к тестам
- формат PR (шаблон/чеклист)
- правило: **каждый Issue имеет Context Pack**
- правило: **PR открыт → In Review**, PR merged → **Done**
- правило: **Reviewer обязателен**

> `AGENTS.md` — главный источник истинны для поведения агентов.

### 2) Context Packs
Папка: `context-packs/`
- по одному markdown-файлу на каждую задачу
- ссылка на файл обязательна в Issue

### 3) GitHub Projects board
- Kanban с полем `Status`
- колонки минимум: Backlog / Ready / In Progress / In Review / Done

### 4) CI (минимальный)
- хотя бы быстрый `lint`/`test` или smoke
- цель: Reviewer мог доверять проверкам

### 5) Issue / PR templates (желательно)
- `.github/ISSUE_TEMPLATE/` (Epic / Task)
- `.github/PULL_REQUEST_TEMPLATE.md`

---

## Role: Planner

### Цель
Превратить неструктурированную “большую идею” в план работ, который:
- можно выполнять параллельно
- не требует постоянных уточнений от тебя
- гарантирует, что Worker-агенты не потеряют контекст

### Вход
- Epic (Issue) или текстовое описание большой задачи
- текущее состояние репозитория
- ограничения (дедлайны/технологии/не делать X)

### Выход
- 8–15 Task issues (обычно)
- каждая Task в колонке **Ready**
- у каждой Task:
  - DoD
  - тест-план
  - dependencies
  - созданный Context Pack (скелет)

### Обязанности (чеклист)
- [ ] Уточнить цель и границы (scope / non-goals)
- [ ] Разбить Epic на 8–15 задач
- [ ] Пометить зависимости (что блокирует что)
- [ ] Отметить параллельные группы (что можно делать одновременно)
- [ ] Создать Context Pack файл на каждую задачу
- [ ] Проставить минимальные labels (type/area/prio/size)
- [ ] Перевести задачи в **Ready**

### Правила декомпозиции
- Task должен вести к одному PR
- Если Task звучит как “сделать полпроекта” — дробить дальше
- Обязательная проверяемость: у каждой задачи есть тест-план

### Что Planner НЕ делает
- не пишет код (если только это не “плановый” PR с шаблонами/доками)
- не закрывает задачи без PR

### Рекомендуемые инструменты
- Cursor (Agent mode) как рабочее место
- GitHub MCP Server (создание issues/комментов/обновление полей)

---

## Role: Worker (Codex / Cursor)

### Цель
Взять одну Task issue и довести её до PR, который можно смёрджить после ревью.

### Вход
- Task issue в статусе **Ready**
- Context Pack (ссылка из Issue)

### Выход
- PR, связанный с Issue (`Closes #<id>`)
- обновлённый Context Pack
- задача в статусе **In Review**

### Обязанности (чеклист)
- [ ] Прочитать Issue + Context Pack
- [ ] Если есть неясность — уточнить в комментариях к Issue и обновить Context Pack
- [ ] Реализовать DoD
- [ ] Выполнить тест-план (или описать ручную проверку)
- [ ] Обновить Context Pack:
  - решение/архитектура (что выбрано и почему)
  - изменённые файлы/точки входа
  - команды/шаги проверки
  - риски/долги
- [ ] Открыть PR:
  - `Closes #<issue>`
  - Summary/How to test/Risks
- [ ] Перевести задачу в **In Review** (или дождаться автоматики)

### Правила работы параллельных Workers
- Один Worker = одна задача
- В “In Progress” у одного исполнителя максимум 1–2 задачи
- Если задача блокируется — перевести в **Blocked** и описать причину

### Рекомендуемый режим для Codex
- Запускать Codex “на одну задачу”
- Запрещено: смешивать несколько issues в одной сессии без явного плана

---

## Role: Reviewer

### Цель
Обеспечить качество и предсказуемость мерджа: соответствие DoD, тест-плану и правилам проекта.

### Вход
- PR в статусе **In Review**
- связанный Issue
- Context Pack
- `AGENTS.md`

### Выход
- Approve (и PR можно мерджить)
- или Request changes (с конкретными правками)
- актуализированный статус задачи (In Progress / Done)

### Обязанности (чеклист)
- [ ] Проверить связь PR ↔ Issue (`Closes #...`)
- [ ] Сверить PR с Goal/DoD
- [ ] Проверить тесты/как проверить
- [ ] Проверить читаемость и поддержку (структура, naming)
- [ ] Проверить edge-cases/ошибки
- [ ] Проверить, что Context Pack обновлён итогом

### Политика ревью
- Замечания должны быть:
  - конкретные
  - проверяемые
  - с предложением исправления
- Если PR большой и тяжело ревьюить — просить дробление

### Reviewer-агент (если используется)
Reviewer-агент **не пишет код**, его задача — оставить комментарии и чеклисты.
Исправления делает Worker.

---

## Автоматизация, которая поддерживает роли

### 1) Planner → creates cards (обязательный сценарий)
Поведение системы:
- Ты создаёшь **Epic** (Issue)
- Planner создаёт **8–15 Task issues**
- Planner проставляет DoD, зависимости и параллельность
- Planner создаёт Context Packs

### 2) Автодвижение статусов
Цель:
- PR открыт → Issue/карточка → **In Review**
- PR merged → Issue/карточка → **Done**

Реализация:
- GitHub Actions + Projects API (или через агента/скрипт)

### 3) Обязательный reviewer gate
Рекомендация:
- защищённая ветка `main`
- требование хотя бы одного approve

---

## Минимальные “права и доступы”

### Для Planner
- создавать issues
- создавать/обновлять файлы Context Packs (через PR или напрямую)
- менять статус в Project

### Для Worker
- создавать ветки/PR
- пушить код
- обновлять Context Packs

### Для Reviewer
- оставлять review-комментарии
- approve/request changes
- (опционально) мерджить

---

## Готовность к запуску (definition of ready для системы)
Система считается готовой, когда:
- [ ] есть GitHub Project board с колонками
- [ ] есть `AGENTS.md`
- [ ] есть папка `context-packs/`
- [ ] есть Issue/PR templates
- [ ] есть минимальный CI
- [ ] описан процесс (этот документ + management + dev process)
